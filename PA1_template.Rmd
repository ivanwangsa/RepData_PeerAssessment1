---
title: 'Reproducible Research: Peer Assessment 1'
output:
  html_document:
    keep_md: yes
  pdf_document: default
---

## Loading and preprocessing the data

At first, we load the packages needed to clean-up the data, namely `lubridate` and `dplyr`. Then, we read the raw data and store it in `raw_data`. We reformat the data on the correct format, more specifically column `date` in `POSIXct` class, and column `interval` in `POSIXct` class, assuming UNIX time (origin = `1970-01-01`).

```{r, preprocess_data, message = FALSE}

library(dplyr)
library(lubridate)

path_to_data <- file.path('data', 'activity.csv')
raw_data <- tbl_df(read.csv(path_to_data))
analytic_data <- raw_data %>%
    mutate(date = ymd(as.character(date))) %>%
    mutate(interval = ((interval %/% 100) * 60 + interval %% 100) * 60) %>%
    mutate(interval = as.POSIXct(interval, origin = '1970-01-01', tz = 'UTC'))
        
```

The following is a preview of the pre-processed data.

```{r, show_analytic_data}
head(analytic_data)
```

## What is mean total number of steps taken per day?

Firstly, we are going to calculate daily total steps, and store it in `daily_total_steps` for further use.

```{r, total_steps}
daily_total_steps <- analytic_data %>%
    group_by(date) %>%
    summarise(total_steps = sum(steps, na.rm = TRUE))

head(daily_total_steps)
```

Next, we are going to take a look on the distribution of the data - some of the data are missing, so it would be of interest to take a look on the skewed distribution and how we are going to fix it. We are going to use `ggplot2` for plotting - the variable `g` will accumulate all plotting information needed.

```{r, plot_total_steps, message = FALSE}
library(ggplot2)

colPalette <- rainbow(45)

g <- ggplot(daily_total_steps, aes(total_steps)) 
g <- g + geom_histogram(col = 'black', fill = colPalette[30]) # colors with blue
g <- g + labs(x = 'Total Steps', y = 'Frequency')
g <- g + labs(title = 'Number of steps taken from 2012/10/01 to 2012/11/31')
g <- g + geom_rug(col = colPalette[27])
g <- g + theme_bw(base_size = 12, base_family = 'sans')

print(g)
```

As we can see, the missing values highly skew the total number of steps taken daily - 10 days with near-to-zero steps are recorded. We are going to discuss what we are going to do with the missing value later - for now, let's see the effect of such outliers with summary statistics of the data; more specifically, median and mean.

```{r, summary_total_steps}
daily_total_steps_summary <- summary(daily_total_steps$total_steps)
median_total_steps <- daily_total_steps_summary['Median']
mean_total_steps <- daily_total_steps_summary['Mean']

print(daily_total_steps_summary[3:4])
```

We recorded median of `r as.character(median_total_steps)` and mean of `r as.character(mean_total_steps)`.

## What is the average daily activity pattern?

Firstly, we are going to calculate the daily average. Using the similar approach with `group_by` function, we get a new summary, named `average_activity_data`. 

```{r, average_activity}
average_activity_data <- analytic_data %>%
    group_by(interval) %>%
    summarise(avg_steps = mean(steps, na.rm = TRUE)) %>%
    arrange(interval) 

head(average_activity_data)
```

The interval will show date of `1970-01-01` - this is due to formatting as POSIXct. Finally, let's show a plot to further understand this.

```{r, plot_average_activity}

library(scales)

g <- ggplot(average_activity_data, aes(interval, avg_steps))
g <- g + geom_line(col = 'blue')
g <- g + scale_x_datetime(labels = date_format('%H:%M'), 
                          breaks = date_breaks('3 hours'), 
                          expand = c(0,0))
g <- g + theme_bw(base_size = 12, base_family = 'sans')
g <- g + labs(x = 'Time of the day', y = 'Average number of steps') 
g <- g + labs(title = 'Average activity data on a day')

print(g)
```

As we can see, we have a peak some-time around 9 AM - around 200 steps. Let's see the maximum average number of steps, and when does it happen.

```{r, find_maximum_average_activity}

result <- average_activity_data %>%
    filter(avg_steps == max(avg_steps))

print(result)
```

Indeed, we see that at time of `r format(result$interval, '%H:%M')`, the maximum number of steps, that is `r format(result$avg_steps, digits = 5)` steps is recorded.

## Inputing missing values



## Are there differences in activity patterns between weekdays and weekends?
